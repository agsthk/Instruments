# align_timestamps.py
- After some thought, I realized that I don't want to use the valve states that were exported to define UZA start/stop - I want to use the Picarro data
	- That way when I adjust the Picarro timestamps, I end up with adjusted valve state times which will work better
	- Easy change to make
- Uncommented the code to adjust Picarro time drift, seeing what that does
	- Added code to plot outliers
	- After correcting time drift, needed to switch join_asof strategy to forward - seems to move the time to be more real
	- Correcting the time drift may be the only thing I need to do for the Picarro instrument
- After checking that the starts and stops were being appropriately identified, reverted the code back to work with joining and plotting differences
	- Does not appear that I corrected the time drift - maybe need to do the reverse of what I did?
		- Yes, that fixed it!
	- Also realized why it should always be a forward join - if Picarro is ahead, then the valve open/closed is inevitably in front of the first/last UZA measurement
- As a side note, it seems that for some weeks the time drift correction overcorrected - need to figure out how to handle that later
- Going to apply a constant offset of 288 seconds to Picarro and remove the time drift to see what that does
	- WAYYYYY too much
- Constant offset of 100s looks reasonable, so expect something within 60 seconds of that
- August 12, 2024 07:53:22 - with a -65s offset, synced with 2BTech_205_A
- Thinking I would actually prefer to have it aligned at the start - will be easier to correct drift after
	- June 10, 2024 08:44:08 aligned with a -56s offset
		- Looks like it's aligned at August 4 also, but not always aligned between?
		- Very clearly drifts weeks of June 24, July 1
			- No or only slight drift other weeks?
- Consider how to correct when no timestamps aligned - choose true timestamp for several false timestamps and interpolate?
	- Likely yes
- Plan is now to identify offsets at several different timestamps and interpolate between those
	- Through June 17 ~13:00, -56 s offset good
	- June 30 23:45, should be -67s offset
		- keep through July 11
	- -56 s offset good starting July 12
	- -60s offset July 20
	- -50s offset July 22
	- -56 July 30
	- -60 through Aug 12
	- -56 on Aug 12
- Settled on timestamp corrections
- Now looking into NOx
	- There is for sure a drift on the NOx - looks relatively steady slope though
		- Actually when I look at it relative to O3, doesn't look like there is a drift
			- Maybe there is a small one
	- For this instrument, going to set two real timestamps - one at the start, one at the end, and interpolate between those
		- ~~Actually I'm just not going to change the NOx timestamp at all~~
- I may revert Picarro timestamp correction to just be a fixed offset - seems to me like it's good enough and then I can leave it
	- Actually, with the amount of work I did I want to say it's fine how it is
- Added code to calculate the duration that the valves are open for each open/closed timestamp
- For Thermo, drift seems to be ~40 us/s
	- When I try to implement that it DOES NOT work
- Going back to my original plan - use the timestamps that I decided on with Picarro, don't change Thermo at all
- Will be moving to implement timestamp correction in clean_rawdata.py
	- What do I do about the already determined valve states?
		- If I just apply a fixed correction, then the answer to this is easy...
			- Come back to here
# clean_rawdata.py
- First, working only with 2024 data
- I think I want to do the timestamp correction prior to the determination of averaging times - that should make things easier
	- I'm going to apply a fixed offset of 60 us to the Picarro data to make it easier on myself
		- STOP SUBSCRIBING TO THE SUNK COST FALLACY!!!!!!!!!!
		- And then I can just change the 2024 valve open/close to be offset by -60s :)
- After making changes, just going to apply them all and create the associated files, then I will check them in another script
- Just realized that I needed to qualify the offset correction to not happen for the DAQ data
	- Fixed to only do offset correction for data that needs it
	- Added offset correction for vent CO2 monitor
# delete.py
- Using this script to check my offset correction
- Added code to plot O3, CH2O, and NO2 overlayed
	- Zeros definitely appear to be aligned
- Checking with "None" sampling location data removed
	- Looks like it did this correctly for the most part
- Checking Picarro data by sampling location
	- Might be something I need to do with zeroing times when the times are repeat times
	- Also need to think about how I am going to ICARTT the data when the times repeat
	- Dates with clear events
		- June 5
		- June 12 (maybe)
		- June 13
		- June 14
		- June 17 UZA ran out
		- June 24 UZA back on
		- July 8
		- July 15
		- July 29???
- 2BTech_205_A data by sampling location
	- Note that Hampel filter doesn't seem to be removing anything??
	- Dates with clear events
		- April 15
		- April 17
		- **April 27**
		- June 5
		- June 6
			- Missing zero?
			- Not all transition points filtered out?
		- June 7 not all transition points filtered out
			- May need to adjust the Picarro offset to more closely match with the O3 times when averaging was set to 2 seconds
				- Don't think it matters with longer averaging time as much, so offset can be more
		- June 12
		- June 13
		- June 17 - UZA runs out
		- June 24 - UZA back on
		- June 25 zeros get WEIRD
		- July 13
		- July 15
		- July 19
		- July 21 - 22 we have zeros not recorded by Picarro
		- July 26
		- August 12 - extra zero not recorded?
- ThermoScientific_42i-TL data by sampling location
	- Dates with clear events
		- April 16
		- April 17?
		- June 13 some interesting stuff with 1st zero
		- June 17 - UZA runs out
		- June 24 - UZA back on
		- July 11 maybe
		- July 13 not all transitions filtered out
		- July 21 - 22 we have zeros not recorded by Picarro
- Overall not looking too bad!
- Lab notebook activities
	- 2/15
		- 13:57 turned on O3 monitor in C200
		- Cycled power 15:13
	- 2/19
		- 8:37 shut down O3 monitor to move tio instrument room
		- 9:08 O3 monitor back on
	- 4/15
		- Moved O3, Thermo, and 2B NOx to TG rack (times?), installed pump pulling 2.9 LPM (no leak?)
	- 4/16
		- Measured flow 07:55
			- 6.8 LPM before filters
			- Installed filter
		- 7:58 adjusted 2B NOx flows
		- Switched pump critical orifice to pull less
		- 8:24 removed one filter membrane
		- 8:34 switched out filter membrane
		- 8:40 adjusted 2BNOx flow
	- 4/17
		- 8:13 turned off instruments to move TG rack
		- Messing with NOx pump flow, not sure if on line?
			- NOx on 11:20 I think on line
			- 12:50 disconnected NOx from sample line
	- 5/1 - 5/2
		- Replaced drierite
	- 5/8
		- 2B NOx off at some point, before 8:30 then back on
	- **5/9** 
		- 8:00, Thermo NOx offline
		- 10:38:11 limonene addition
	- 5/10
		- 13:08 limonene addition
	- 5/14
		- 08:28 O3 and 2B NOx monitors off
		- 13:06 instruments and pumps on
		- 2 hours later, Thermo off again
		- Installed CO monitor
		- 15:20 limonene addition
	- 5/15
		- 13:16 methanol addition
	- 5/16
		- 10:54, 11:02, 11:08 nicotine sensitivity test
		- 13:26 urea addition
	- 5/17
		- 13:14 D5-siloxane addition
	- **5/28**
		- **Bypass pump turned off 13:31, back on when?**
	- 6/4
		- 09:32-09:34 removed O3 monitor from TG line for cal, line capped by 09:34
		- 12:58 - 13:00, reconnected O3 monitor to TG line
		- 13:19 chlorox wipe
	- 6/5
		- Setting up TG line 09:15 - 13:30
		- 9:15 - 11:10 adding HCHO montior to line, turned on 11:27
		- 11:12-11:20 Thermo on room air
	- 6/6
		- CO cycled ~12:10
		- 15:00 limonene
	- 6/7
		- 14:00 lemon cutting, retrieved 14:10
	- 6/10
		- 8:13 shut down HCHO, restarted it 
	- 6/12
		- 10:10 limonene
		- Changed NOx diaphragm pump
		- NOx on room air 16:20
	- 6/13
		- 8:15 -8:20 adjusting 2BNox flows
		- Thermo nox reconneccted 08:20 - 08:30
		- Flows adjusted 08:55 - 09:35 (messing with 2B NOx flows until 9:55)
		- 10:00 d5 siloxane
		- 11:04 d5 siloxane
	- 6/18
		- 10:00 orange peeling, removed 10:10
		- 15:00 pinesol cleaning, removed 15:08
	- 6/24
		- 08:53 CO monitor shut down and disconnected
		- 08:53 Thermo NOx off to move pump, back on 9:26
		- Adjusting TG inlet location 14:30 -15:00
		- 15:30 - 15:30 (?) adjusting TG flows
	- 6/25
		- 2BNOx monitor out of room
		- 08:01 lemon zesting, removed 08:13
		- 12:10 lemon peeling
		- 15:29 pinesol cleaning, out 16:08
	- **6/28**
		- **9:00 limonene add**
		- **17:00 limonene?**
	- 7/2
		- 10:02 urea
		- 11:02 caffeine
		- 12:02 nicotine
	- 7/3
		- 9:03 limonene
	- 7/8
		- 14:29 - 14:40 removed NOx from TG line for cal
	- 7/9
		- 7:37 a pinene
		- 15:01 a pinene
	- 7/10
		- 7:32 a pinene
		- 16:29 myrcene
	- 7/11
		- 8:30 linalool
		- 13:57 linalool
	- 7/12
		- 9:09 limonene
		- 17:01 limonene
	- 7/15 overheated!
		- 14:20 - 14:30 adjusting TG flows
	- 7/16
		- 9:01 limonene
	- 7/17
		- 9:00 limonene
	- 7/18
		- 9:01 limonene
	- 7/19
		- 9:01 limonene
	- **7/21 - 7/22 add zeros!!**
	- 7/23 smoke outside
	- 7/24
		- 08:47 thermo off and drierite replaced, restarted 8:57
		- 9:000 limonene
	- 7/25
		- 9:00 limonene
	- 7/26
		- 7:30 myrcene
		- 15:01 carene
		- **What's happening ~17:45?**
	- **What's happening 7/29?**
	- 7/30
		- 9:00 13C limonene
		- **Noise?**
	- 7/31
		- 14:30 GUV, off 16:30
	- 8/1
		- 9:00 13C limonene
	- 8/2
		- GUV
	- 8/6 overnight ACR not good bc door open
		- 9:01 limonene
		- 12:00 - 16:07 GUV
	- 8/7
		- 9:01 limonene
		- 15:00 vent covers removed
	- 8/8
		- 9:01 limonene
		- 12:01 limonene
		- 15:01 limonene
	- 8/9
		- 9:31 limonene
		- 12:00 limonene
		- 15:00 limonene
	- 8/12
		- 10:21 shut down thermo NOx
		- 10:32 shut down HCHO
		- **Missing zero**
- Come back to this tomorrow, looking at Picarro (and Thermo)